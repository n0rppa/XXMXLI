<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <title>Musiikkisoitin ja visualizer</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 2em auto; background: #f2f2f2; }
    .player { background: #fff; border-radius: 10px; padding: 2em; }
    .controls { margin-top: 1em; }
    button { margin: 0 5px; }
    #progress { width: 100%; }
    canvas { width: 100%; height: 100px; background: #000; display: block; border-radius: 8px; margin-top: 1em; }
    select { width: 100%; margin-top: 1em; }
  </style>
</head>
<body>
  <div class="player">
    <h2>Äänisoitin + Visualizer</h2>
    <audio id="audio" src="assets/audio/01. Hip-Hop Intro.flac"></audio>
    <div class="controls">
      <button onclick="playAudio()">▶️</button>
      <button onclick="pauseAudio()">⏸️</button>
      <button onclick="stopAudio()">⏹️</button>
      <input type="range" id="progress" value="0" min="0" max="100" step="1">
    </div>
    <canvas id="visualizer" width="560" height="100"></canvas>
    <div>
      <label for="track">Valitse kappale:</label>
      <select id="track" onchange="changeTrack()">
        <option value="assets/audio/01. Hip-Hop Intro.flac">01. Hip-Hop Intro</option>
        <option value="assets/audio/03.Mellow(1).flac">03. Mellow(1)</option>
        <option value="assets/audio/07.Strange.flac">07. Strange</option>
        <option value="assets/audio/09.Swishaz.flac">09. Swishaz</option>
        <option value="assets/audio/10.Frosty.flac">10. Frosty</option>
        <option value="assets/audio/17.Mist.flac">17. Mist</option>
        <option value="assets/audio/18.Alley.flac">18. Alley</option>
        <option value="assets/audio/20.Cloudy instrumental.flac">20. Cloudy instrumental</option>
        <option value="assets/audio/23.Chill oldschool beat.flac">23. Chill oldschool beat</option>
        <option value="assets/audio/Jazz instrumental.flac">Jazz instrumental</option>
        <option value="assets/audio/Rain (1).flac">Rain (1)</option>
        <option value="assets/audio/Rain (2).flac">Rain (2)</option>
      </select>
    </div>
  </div>
  <script>
    const audio = document.getElementById('audio');
    const progress = document.getElementById('progress');
    const track = document.getElementById('track');
    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');

    // Audio analysointi
    let audioContext, analyser, source, dataArray, animationId;

    function setupAudioContext() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        source = audioContext.createMediaElementSource(audio);
        source.connect(analyser);
        analyser.connect(audioContext.destination);
        analyser.fftSize = 64;
        dataArray = new Uint8Array(analyser.frequencyBinCount);
      }
    }

    function drawVisualizer() {
      analyser.getByteFrequencyData(dataArray);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      let barWidth = (canvas.width / dataArray.length) * 1.5;
      let barHeight;
      let x = 0;
      for (let i = 0; i < dataArray.length; i++) {
        barHeight = dataArray[i] * 0.7;
        ctx.fillStyle = 'rgb(' + (barHeight + 80) + ',50,180)';
        ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
        x += barWidth + 1;
      }
      animationId = requestAnimationFrame(drawVisualizer);
    }

    audio.addEventListener('play', () => {
      setupAudioContext();
      drawVisualizer();
    });

    audio.addEventListener('pause', () => cancelAnimationFrame(animationId));
    audio.addEventListener('ended', () => cancelAnimationFrame(animationId));

    // Soitinohjaimet
    audio.addEventListener('timeupdate', () => {
      progress.value = (audio.currentTime / audio.duration) * 100 || 0;
    });

    progress.addEventListener('input', () => {
      audio.currentTime = (progress.value / 100) * audio.duration;
    });

    function playAudio() {
      audio.play();
      if (audioContext && audioContext.state === 'suspended') {
        audioContext.resume();
      }
    }
    function pauseAudio() { audio.pause(); }
    function stopAudio() { audio.pause(); audio.currentTime = 0; }

    function changeTrack() {
      audio.src = track.value;
      audio.currentTime = 0;
      audio.play();
    }
  </script>
</body>
</html>