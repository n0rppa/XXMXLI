<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Auto-listing Music Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css?family=Barlow:400,700|Barlow+Condensed:700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Barlow', sans-serif;
  background: #181818;
  color: #e8e8f0;
  margin: 0;
  padding: 0;
}
.wrapper {
  max-width: 430px;
  margin: 70px auto 0 auto;
  background: #23232c;
  border-radius: 18px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.25);
  overflow: hidden;
}
.content {
  padding: 20px 30px 30px 30px;
}
.menuBar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 14px;
}
.menuBar .appName {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 1.4em;
  font-weight: 700;
  letter-spacing: 2px;
  color: #ffedc0;
  margin: 0;
}
.musicGroups {
  margin-top: 24px;
}
ul.song-list {
  list-style: none;
  padding: 0; margin: 0;
}
ul.song-list li {
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  background: #222234;
  border-radius: 12px;
  padding: 12px;
  cursor: pointer;
  transition: background 0.15s;
}
ul.song-list li.active {
  background: #ffedc0;
  color: #23232c;
}
.song-info {
  flex: 1 1 auto;
  min-width: 0;
}
.song-title {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 1.1em;
  font-weight: 700;
  margin-bottom: 2px;
  color: inherit;
}
.song-artist {
  font-size: 0.92em;
  color: #b0b0c0;
}
.song-duration {
  margin-left: 12px;
  font-size: 0.98em;
  color: #aeea00;
  min-width: 46px;
  text-align: right;
}
.song-play {
  margin-left: 12px;
  background: #ffedc0;
  color: #23232c;
  border: none;
  border-radius: 50%;
  width: 36px; height: 36px;
  font-size: 1.3em;
  cursor: pointer;
  transition: background 0.2s;
}
.song-play:hover {
  background: #ffe08c;
}
.player-controls {
  margin-top: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 18px;
}
.player-controls button {
  background: #23232c;
  color: #ffedc0;
  border: none;
  border-radius: 50%;
  width: 36px; height: 36px;
  font-size: 1.2em;
  cursor: pointer;
  transition: background 0.2s;
}
.player-controls button:hover {
  background: #ffedc0;
  color: #23232c;
}
#now-playing {
  margin-top: 16px;
  text-align: center;
  color: #ffedc0;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 1.1em;
  min-height: 1.5em;
}
audio {
  width: 100%;
  margin-top: 16px;
  outline: none;
  background: #23232c;
  border-radius: 8px;
}
@media (max-width: 480px) {
  .wrapper { margin: 30px 3vw 0 3vw; }
  .content { padding: 12px 6px 24px 6px; }
}
</style>
<script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>
</head>
<body>
<div class="wrapper">
  <div class="content">
    <div class="menuBar">
      <p class="appName">Your Library</p>
    </div>
    <div class="musicGroups">
      <ul class="song-list" id="song-list"></ul>
      <div class="player-controls">
        <button id="prev-btn" title="Previous">&#9198;</button>
        <button id="play-btn" title="Play/Pause">&#9658;</button>
        <button id="next-btn" title="Next">&#9197;</button>
      </div>
      <div id="now-playing"></div>
      <audio id="audio" controls preload="metadata"></audio>
    </div>
  </div>
</div>
<script>
const AUDIO_DIR = "assets/audio/";
const AUDIO_EXTS = [".mp3",".flac",".ogg",".wav"];
let songs = [];
let current = 0;

const audio = document.getElementById('audio');
const songList = document.getElementById('song-list');
const nowPlaying = document.getElementById('now-playing');
const playBtn = document.getElementById('play-btn');
const nextBtn = document.getElementById('next-btn');
const prevBtn = document.getElementById('prev-btn');

// Try to fetch tracklist.json (autogenerated by workflow) OR fallback to directory index if served
async function getSongFiles() {
  let files = [];
  // Try tracklist.json (preferred)
  try {
    const res = await fetch(AUDIO_DIR + "tracklist.json");
    if (res.ok) {
      files = await res.json();
      // [{file:...}] or ["file",...]
      if (files.length && typeof files[0] === "string") {
        files = files.map(f => ({ file: f }));
      }
      files = files.map(f => f.file || f); // Make sure we have a file property
    }
  } catch (e) {}
  // If not, try to list via directory index (works only if server allows listing, e.g. locally)
  if (!files.length) {
    // Not supported on GitHub Pages, so you should use the Actions workflow to autogen tracklist.json!
    alert("tracks not found - make sure assets/audio/tracklist.json exists!");
    return [];
  }
  // Filter supported extensions
  return files.filter(f => AUDIO_EXTS.some(ext => f.toLowerCase().endsWith(ext)));
}

// Read metadata (title, artist, duration) using jsmediatags and HTMLAudioElement
async function extractMetadata(file) {
  return new Promise(resolve => {
    const src = AUDIO_DIR + file;
    let song = { src, file, title: file, artist: "", duration: "" };
    // Try jsmediatags
    window.jsmediatags.read(src, {
      onSuccess: tag => {
        if (tag.tags.title) song.title = tag.tags.title;
        if (tag.tags.artist) song.artist = tag.tags.artist;
        resolve(song);
      },
      onError: () => resolve(song)
    });
    // Audio duration
    const tempAudio = document.createElement('audio');
    tempAudio.src = src;
    tempAudio.preload = 'metadata';
    tempAudio.addEventListener('loadedmetadata', function() {
      if (!isNaN(tempAudio.duration)) {
        const m = Math.floor(tempAudio.duration / 60);
        let s = Math.floor(tempAudio.duration % 60);
        if (s < 10) s = "0" + s;
        song.duration = `${m}:${s}`;
      }
    });
  });
}

async function loadSongs() {
  const files = await getSongFiles();
  // Extract metadata for each file
  songs = await Promise.all(files.map(extractMetadata));
  // Sort by file name (optional)
  songs.sort((a,b) => a.file.localeCompare(b.file));
  renderList();
  playSong(0);
}

function renderList() {
  songList.innerHTML = '';
  songs.forEach((song, idx) => {
    const li = document.createElement('li');
    li.className = (idx === current) ? 'active' : '';
    // Info
    const info = document.createElement('div');
    info.className = 'song-info';
    info.innerHTML = `<div class="song-title">${song.title || song.file}</div>
      <div class="song-artist">${song.artist || ""}</div>`;
    li.appendChild(info);
    // Duration
    const dur = document.createElement('div');
    dur.className = 'song-duration';
    dur.textContent = song.duration || '--:--';
    li.appendChild(dur);
    // Play
    const btn = document.createElement('button');
    btn.className = 'song-play';
    btn.innerHTML = (idx === current && !audio.paused) ? '&#10073;&#10073;' : '&#9658;';
    btn.onclick =.stopPropagation();
      if (current === idx) {
        if (audio.paused) audio.play();
        else audio.pause();
      } else {
        playSong(idx);
      }
    };
    li.appendChild(btn);
    li.onclick = () => playSong(idx);
    songList.appendChild(li);
  });
}

function playSong(idx) {
  if (!songs[idx]) return;
  current = idx;
  audio.src = songs[idx].src;
  audio.play();
  updateUI();
}

function updateUI() {
  renderList();
  nowPlaying.textContent = `${songs[current].title || songs[current].file}` +
    (songs[current].artist ? ` â€” ${songs[current].artist}` : "");
}

audio.addEventListener('ended', () => {
  nextSong();
});
audio.addEventListener('play', updateUI);
audio.addEventListener('pause', updateUI);

function nextSong() {
  current = (current + 1) % songs.length;
  playSong(current);
}
function prevSong() {
  current = (current - 1 + songs.length) % songs.length;
  playSong(current);
}

playBtn.onclick = () => {
  if (audio.paused) audio.play();
  else audio.pause();
};
nextBtn.onclick = nextSong;
prevBtn.onclick = prevSong;

window.addEventListener('DOMContentLoaded', loadSongs);
</script>
</body>
</html>